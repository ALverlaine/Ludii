(game "Asi Keliya"
    (players 4)
    (equipment {
        (board
            (merge {
                (add
                    (merge {
                        (rectangle 3 4)
                        (shift 7 0 (rectangle 3 4))
                        (shift 3.5 3.5 (rotate 90 (rectangle 3 4)))
                        (shift 3.5 -3.5 (rotate 90 (rectangle 3 4)))
                    })
                    edges:{{19 20} {4 35}}
                )
                (shift 3 3 (square 1))
                (shift 7 3 (square 1))
                (shift 3 -1 (square 1))
                (shift 7 -1 (square 1))
            })
        )
        (piece "Marker" Each)
        (hand Each)
        (dice d:2 from:0 num:6)
    })
    (rules 
        (start (place "Marker" "Hand" count:4))
        (play (do (roll) next:(forEach Piece)))
        (end (if (no Moves Next) (result Mover Win)))
    )
)

//------------------------------------------------------------------------------

(metadata 
    
    (info
        {
        (description "Asi Keliya is a race game played in Sri Lanka in the early twentieth century. It is related to other race games played on a cross-shaped board in South Asia, but its board is smaller than others. ")
        (aliases {"Sonaru"})
        (rules "Four 3x4 rectangles, arranged in a cross shape, with a large central square which has diagonals, and spaces in the four corners between each arm of the cross. Four players, played on two teams, with team members sitting on opposite sides of the board. Four pieces per player, with the colors red, black, yellow, and green. Six cowrie shells used as dice: five are white and one is yellow. The number of the mouths which are face-up determine the value of the throw, except for a throw of 3 when one of the cowries with the mouth down is the yellow one, in which case the throw is known as So-hatara, and counts as 4, but allows special moves because it is actually considered four individual throws of 1. When the player throws 1, 5, or So-hatara, the player receives an extra throw. The throws are added up at the end of each sequence of throws. and the total is played. A 1, 5, or So-hatara must be thrown to enter a piece on the board. The entirety of a throw must be used to move one piece, but separate throws in a turn can each be used individually to move a different piece. This does not apply when So-hatara is one of the throws; in this case, the total of the throw can be subdivided however the player sees fit. Pieces enter the board from the center, moving down the central track of their arm, then in an anti-clockwise direction around the board, and then back up the central row of their arm of the board to the central square. players may not move beyond a piece of the opposing team, unless they have thrown So-hatara. In this case, a piece moving beyond an opponent's piece sends the opponent's piece back to start. If a player lands on a space occupied by a piece of the opposing team, the opponent's piece is sent back to start. If two of the opponent's pieces are on this space, they both are sent back to start, but may both reenter with a throw ordinarily applied to reenter one piece. Pieces resting on the corner spaces between the arms of the cross cannot be sent to start in any circumstance. When pieces reach the central row of their arm, they may only proceed along it one space at a time, with a throw of 1 or So-hatara. They are placed on their side when moving up this row. The first team who places all of their pieces in the central square wins.
        ")
        (source "Parker 1909: 614-617.")
        (version "1.2.0")
        (classification "race/WishlistDLP")
        (credit "Eric Piette")
        (origin  "This game was played in Sri Lanka, around 1909.")
        }
    )
    
    (graphics {
        (show Edges Diagonal Hidden)
        (player Colour P1 (colour Red))
        (player Colour P2 (colour Black))
        (player Colour P3 (colour Yellow))
        (player Colour P4 (colour Green))
        (board Colour Phase0 (colour 223 178 110))
        (board Colour InnerEdges (colour Black))
        (board Colour OuterEdges (colour Black))
    })
    
)
