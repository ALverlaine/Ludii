(define "MidpointSquares" 
    (forEach (sites Board) 
        if:(and
            (= 4 
                (count Sites in:(sites Around (site)))
            )
            (not (is In (site) (sites Outer)))
        )
    )		
)

(define "AllCornersSquareEmpty" 
    (all Sites
        (sites Around (site))
        if:(is Empty (site))
    )
)

(define "AllCornersSquareOccupied" 
    (all Sites
        (sites Around (site))
        if:(is Occupied (site))
    )
)

(define "NumEnemyCorners" 
    (count Sites 
        in:(forEach 
            (sites Around (site)) 
            if:(is Enemy (who at:(site)))
        )
    )
)

(define "NumEnemyOppositeCorners" 
    (count Sites 
        in:(forEach 
            (sites Around (site)) 
            if:(and 
                (is In (site) (sites Around (last To))) 
                (is Enemy (who at:(site)))
            )
        )
    )
)

//------------------------------------------------------------------------------

(game "Diamond"  
    (players 2)  
    (equipment { 
        (board 
        	(rotate 90 (tiling T33434 3))
            use:Vertex
        ) 
        (piece "Disc" Each (move Step (to if:(is Empty (to))))) 
        (piece "Disc" Neutral)
        (hand Each)
        (regions P1 { (sites Side W) (sites Side E) } )
        (regions P2 { (sites Side N) (sites Side S) } )
    })  
    (rules
    	(start (place "Disc" "Hand" count:12))
    	
    	phases:{
    	(phase "Placement"
    	        (play 
    	           (move
    	        	(from (handSite Mover))
    	        	(to (sites Empty))
    	           )
    	        )
    	        (nextPhase Mover (is Empty (handSite Mover)) "Movement")
            )
    	(phase "Movement"
	        (play 
	           (forEach Piece)
	        )
        )
    	}
        (end (if (is Connected Mover) (result Mover Win))) 
    )
)

//------------------------------------------------------------------------------

(metadata 
    
    (info
        {
        }
    )
    
    (graphics {
        (player Colour Neutral (colour Red))
        (player Colour P1 (colour Black))
        (player Colour P2 (colour White))
        (board Background image:"square.svg" fillColour:(colour 218 164 50) edgeColour:(colour Black) scale:1.3)
        (board Colour InnerEdges (colour Black))
        (board Colour OuterEdges (colour Black)) 
        (board Colour InnerVertices (colour Hidden))
        (board Colour OuterVertices (colour Hidden)) 
        (show Edges Diagonal (colour Hidden))
    })
)
