(define "CaptureToPiece"
    (apply 
        (remove 
            (to) 
        )
    ) 
)

(define "CaptureForwardDiagonal"
    (move
        Step 
        (directions {FR FL}) 
        (to 
            if:(is Enemy (who at:(to))) 
            (apply (remove (to)))
        )
    )
)

(define "NextCanNotMove"
    (not (can Move (do (forEach Piece Next) ifAfterwards:(not ("IsInCheck" "King_noCross" Next)))) )
)

//------------------------------------------------------------------------------

(game "Shataranja"
	    (players {(player N) (player S)})  
    (equipment { 
        (board (square 10)) 
                (piece "Pawn" Each 
                            (or 
                                    "StepForwardToEmpty" 
                                    "CaptureForwardDiagonal"
                                    (then
                                            (if (is In (last To) (sites Mover "Promotion")) 
                                                (and
                                                    (promote (last To) (piece "Bishop_noCross") Mover)	
                                                    (fromTo (from (last To)) (to (last From)))
                                                )
                                            )
                                        )
                            )
                    )
                    (piece "Rook" Each 
                            (move
                                    Slide 
                                    Orthogonal 
                                    (to 
                                            if:(is Enemy (who at:(to))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    )
                    (piece "King_noCross" Each 
                            (move
                                    Step 
                                    (to 
                                            if:(not (is Friend (who at:(to)))) 
                                            "CaptureToPiece" 
                                    )
                            )
                    )
                    (piece "Elephant" Each 
                    		 (move
                                     Slide 
                                     Orthogonal 
                                     (to 
                                             if:(is Enemy (who at:(to))) 
                                             "CaptureToPiece"
                                     ) 
                             )		
                    ) 
                    (piece "Knight" Each 
                            (move
                                    Leap 
                                    "KnightWalk" 
                                    (to 
                                            if:(not (is Friend (who at:(to)))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    )
                    (piece "Queen" Each 
                    		(move
                                    Step 
                                    (to 
                                            if:(not (is Friend (who at:(to)))) 
                                            "CaptureToPiece" 
                                    )
                            )
                    )
                    (piece "Ferz_noCross" Each 
                    		(or
                    		(move
                                    Slide 
                                    (to 
                                            if:(is Enemy (who at:(to))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    		(move
                                    Leap 
                                    "KnightWalk" 
                                    (to 
                                            if:(not (is Friend (who at:(to)))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    		)
                    )
                    (piece "Bishop_noCross" Each 
                    		(move
                                    Slide 
                                    (to 
                                            if:(is Enemy (who at:(to))) 
                                            "CaptureToPiece"
                                    ) 
                            )		
                   ) 
                    (piece "Commoner" Each 
                    		(or
                    		(move
                                    Slide
                                    Diagonal
                                    (to 
                                            if:(is Enemy (who at:(to))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    		(move
                                    Leap 
                                    "KnightWalk" 
                                    (to 
                                            if:(not (is Friend (who at:(to)))) 
                                            "CaptureToPiece"
                                    ) 
                            )
                    		)		
                   ) 
                    (regions "Promotion" P1 (sites Top) )
                    (regions "Promotion" P2 (sites Bottom) )
    })
    (rules 
            (start { 
                (place "Pawn1" (difference (sites Row 1) (sites {"E2" "F2"})))
                (place "Pawn2" (difference (sites Row 8) (sites {"E2" "F2"})))
                (place "Queen1" {"E2" "F2"})
                (place "Queen2" {"E9" "F9"})
                (place "Rook1" {"A1" "J1"}) (place "Knight1" {"B1" "I1" "E3" "F3"}) (place "Elephant1" {"C1" "H1"}) (place "Ferz_noCross1" coord:"E1") (place "Commoner1" coord:"G1") (place "Bishop_noCross1" coord:"D1") (place "King_noCross1" coord:"F1") 
                (place "Rook2" {"A10" "J10"}) (place "Knight2" {"B10" "I10" "E8" "F8"}) (place "Elephant2" {"C10" "H10"}) (place "Ferz_noCross2" coord:"F10") (place "Commoner2" coord:"D10") (place "Bishop_noCross2" coord:"G10") (place "King_noCross2" coord:"E10") 
            })
            
            (play 
                	(if (no Moves Mover)
                		(move Remove
                			(difference (sites Occupied by:Next) (where "King_noCross" Next))
                		)
                    (do (forEach Piece) ifAfterwards:(not ("IsInCheck" "King_noCross" Mover)))
                    )
            )
            
            (end {
                (if (and 
                        ("IsInCheck" "King_noCross" Next)
                        ("NextCanNotMove")
                    ) 
                    (result Mover Win)
                ) 
                (if (and {
                    (no Pieces Next "Ferz_noCross")
                    (no Pieces Next "Queen")
                    (no Pieces Next "Knight")
                    (no Pieces Next "Bishop_noCross")
                    (no Pieces Next "Elephant")
                    (no Pieces Next "Rook")
                    (no Pieces Next "Commoner")
                })
                	(result Mover Win) 
                ) 
            })
    )
)

//------------------------------------------------------------------------------

(metadata 
    
    (info
        {
        (description "Chaturanga is a replacement capture game played in India. This version is described in the nineteenth century, and was played on a 10x10 board.
            
        ")
        (rules "10x10 board.")
        (source "DLP evidence.")
        (version "1.2.11")
        (classification "board/war/replacement/checkmate/chaturanga/reconstruction")
        (credit "Eric Piette")
        }
    )
    
    (graphics {
        (board Colour Phase0 (colour 223 178 110))
        (board Colour InnerEdges (colour Black))
        (board Colour OuterEdges (colour Black))
    })
    
)
